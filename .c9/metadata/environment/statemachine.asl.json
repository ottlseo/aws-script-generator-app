{"filter":false,"title":"statemachine.asl.json","tooltip":"/statemachine.asl.json","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":76,"column":1},"action":"insert","lines":["{","  \"Comment\": \"A description of my state machine\",","  \"StartAt\": \"StartTranscriptionJob\",","  \"States\": {","    \"StartTranscriptionJob\": {","      \"Type\": \"Task\",","      \"Parameters\": {","        \"Media\": {","          \"MediaFileUri.$\": \"States.Format('s3://{}/{}',$.BucketName,$.VideoKey)\"","        },","        \"TranscriptionJobName.$\": \"$$.Execution.Name\",","        \"LanguageCode\": \"en-US\",","        \"OutputBucketName.$\": \"$.BucketName\",","        \"OutputKey\": \"temp.json\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:transcribe:startTranscriptionJob\",","      \"Next\": \"Wait\",","      \"ResultPath\": \"$.transcription\"","    },","    \"Wait\": {","      \"Type\": \"Wait\",","      \"Seconds\": 10,","      \"Next\": \"GetTranscriptionJobStatus\"","    },","    \"GetTranscriptionJobStatus\": {","      \"Type\": \"Task\",","      \"Parameters\": {","        \"TranscriptionJobName.$\": \"$.transcription.TranscriptionJob.TranscriptionJobName\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:transcribe:getTranscriptionJob\",","      \"Next\": \"Choice\",","      \"ResultPath\": \"$.transcription\"","    },","    \"Choice\": {","      \"Type\": \"Choice\",","      \"Choices\": [","        {","          \"Variable\": \"$.transcription.TranscriptionJob.TranscriptionJobStatus\",","          \"StringMatches\": \"COMPLETED\",","          \"Next\": \"GetObject\"","        },","        {","          \"Variable\": \"$.transcription.TranscriptionJob.TranscriptionJobStatus\",","          \"StringMatches\": \"FAILED\",","          \"Next\": \"Fail\"","        }","      ],","      \"Default\": \"Wait\"","    },","    \"GetObject\": {","      \"Type\": \"Task\",","      \"Parameters\": {","        \"Bucket.$\": \"$.BucketName\",","        \"Key\": \"temp.json\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:s3:getObject\",","      \"ResultSelector\": {","        \"filecontent.$\": \"States.StringToJson($.Body)\"","      },","      \"Next\": \"PutObject\",","      \"ResultPath\": \"$.transcription\"","    },","    \"PutObject\": {","      \"Type\": \"Task\",","      \"End\": true,","      \"Parameters\": {","        \"Body.$\": \"$.transcription.filecontent.results.transcripts[0].transcript\",","        \"Bucket.$\": \"$.BucketName\",","        \"Key\": \"transcript.txt\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\"","    },","    \"Fail\": {","      \"Type\": \"Fail\"","    }","  }","}"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":76,"column":1},"action":"remove","lines":["{","  \"Comment\": \"A description of my state machine\",","  \"StartAt\": \"StartTranscriptionJob\",","  \"States\": {","    \"StartTranscriptionJob\": {","      \"Type\": \"Task\",","      \"Parameters\": {","        \"Media\": {","          \"MediaFileUri.$\": \"States.Format('s3://{}/{}',$.BucketName,$.VideoKey)\"","        },","        \"TranscriptionJobName.$\": \"$$.Execution.Name\",","        \"LanguageCode\": \"en-US\",","        \"OutputBucketName.$\": \"$.BucketName\",","        \"OutputKey\": \"temp.json\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:transcribe:startTranscriptionJob\",","      \"Next\": \"Wait\",","      \"ResultPath\": \"$.transcription\"","    },","    \"Wait\": {","      \"Type\": \"Wait\",","      \"Seconds\": 10,","      \"Next\": \"GetTranscriptionJobStatus\"","    },","    \"GetTranscriptionJobStatus\": {","      \"Type\": \"Task\",","      \"Parameters\": {","        \"TranscriptionJobName.$\": \"$.transcription.TranscriptionJob.TranscriptionJobName\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:transcribe:getTranscriptionJob\",","      \"Next\": \"Choice\",","      \"ResultPath\": \"$.transcription\"","    },","    \"Choice\": {","      \"Type\": \"Choice\",","      \"Choices\": [","        {","          \"Variable\": \"$.transcription.TranscriptionJob.TranscriptionJobStatus\",","          \"StringMatches\": \"COMPLETED\",","          \"Next\": \"GetObject\"","        },","        {","          \"Variable\": \"$.transcription.TranscriptionJob.TranscriptionJobStatus\",","          \"StringMatches\": \"FAILED\",","          \"Next\": \"Fail\"","        }","      ],","      \"Default\": \"Wait\"","    },","    \"GetObject\": {","      \"Type\": \"Task\",","      \"Parameters\": {","        \"Bucket.$\": \"$.BucketName\",","        \"Key\": \"temp.json\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:s3:getObject\",","      \"ResultSelector\": {","        \"filecontent.$\": \"States.StringToJson($.Body)\"","      },","      \"Next\": \"PutObject\",","      \"ResultPath\": \"$.transcription\"","    },","    \"PutObject\": {","      \"Type\": \"Task\",","      \"End\": true,","      \"Parameters\": {","        \"Body.$\": \"$.transcription.filecontent.results.transcripts[0].transcript\",","        \"Bucket.$\": \"$.BucketName\",","        \"Key\": \"transcript.txt\"","      },","      \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\"","    },","    \"Fail\": {","      \"Type\": \"Fail\"","    }","  }","}"],"id":2},{"start":{"row":0,"column":0},"end":{"row":80,"column":1},"action":"insert","lines":["{","    \"Comment\": \"Invoke Transcribe on a media file, when complete execute the results query Step Function and output the results\",","    \"StartAt\": \"StartTranscriptionJob\",","    \"States\": {","        \"Failed\": {","            \"Cause\": \"transcription job failed\",","            \"Error\": \"FAILED\",","            \"Type\": \"Fail\"","        },","        \"GetObject\": {","            \"Comment\": \"Get Transcribed json file\",","            \"Next\": \"PutObject\",","            \"Parameters\": {","                \"Bucket\": \"bucket-776177632559-us-east-1-transcript-results\",","                \"Key\": \"temp.json\"","            },","            \"Resource\": \"arn:aws:states:us-east-1:776177632559:aws-sdk:s3:getObject\",","            \"ResultPath\": \"$.transcription\",","            \"ResultSelector\": {","                \"filecontent.$\\\"\": \"States.StringToJson($.Body)\"","            },","            \"Type\": \"Task\"","        },","        \"GetTranscriptionJob\": {","            \"Comment\": \"Retrieve the status of an Amazon Transcribe job\",","            \"Next\": \"TranscriptionJobStatus\",","            \"Parameters\": {","                \"TranscriptionJobName.$\": \"$.TranscriptionJob.TranscriptionJobName\"","            },","            \"Resource\": \"arn:aws:states:us-east-1:776177632559:aws-sdk:transcribe:getTranscriptionJob\",","            \"Type\": \"Task\"","        },","        \"PutObject\": {","            \"Comment\": \"extract transcription text in json file\",","            \"End\": true,","            \"Parameters\": {","                \"Body.$\": \"$.transcription.filecontent.results.transcripts[0].transcript\",","                \"Bucket\": \"bucket-776177632559-us-east-1-transcript-results\",","                \"Key\": \"transcript.txt\"","            },","            \"Resource\": \"arn:aws:states:us-east-1:776177632559:aws-sdk:s3:putObject\",","            \"Type\": \"Task\"","        },","        \"StartTranscriptionJob\": {","            \"Comment\": \"Start a transcribe job on the provided media file\",","            \"Next\": \"Wait\",","            \"Parameters\": {","                \"IdentifyLanguage\": true,","                \"Media\": {","                    \"MediaFileUri.$\": \"States.Format('s3://{}/{}', $.detail.bucket.name, $.detail.object.key)\"","                },","                \"OutputBucketName\": \"bucket-776177632559-us-east-1-transcript-results\",","                \"TranscriptionJobName.$\": \"$.detail.object.key\"","            },","            \"Resource\": \"arn:aws:states:us-east-1:776177632559:aws-sdk:transcribe:startTranscriptionJob\",","            \"Type\": \"Task\"","        },","        \"TranscriptionJobStatus\": {","            \"Choices\": [","                {","                    \"Next\": \"GetObject\",","                    \"StringEquals\": \"COMPLETED\",","                    \"Variable\": \"$.TranscriptionJob.TranscriptionJobStatus\"","                },","                {","                    \"Next\": \"Failed\",","                    \"StringEquals\": \"FAILED\",","                    \"Variable\": \"$.TranscriptionJob.TranscriptionJobStatus\"","                }","            ],","            \"Default\": \"Wait\",","            \"Type\": \"Choice\"","        },","        \"Wait\": {","            \"Next\": \"GetTranscriptionJob\",","            \"Seconds\": 60,","            \"Type\": \"Wait\"","        }","    },","    \"TimeoutSeconds\": 900","}"]}]]},"ace":{"folds":[],"scrolltop":823,"scrollleft":0,"selection":{"start":{"row":65,"column":23},"end":{"row":65,"column":23},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":46,"state":"start","mode":"ace/mode/json"}},"timestamp":1658649531747,"hash":"566c53887c8201ae2055bfc6e2c41b7c7eb69ceb"}